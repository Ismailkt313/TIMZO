<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timzo - Premium Watches</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/landingPage.css">
    <link rel="icon" type="image/x-icon" href="/images/TIMZO.jpg">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .hero-section {
            background: url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c') no-repeat center center;
            background-size: cover;
            position: relative;
            padding: 100px 0;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        .hero-section .container {
            position: relative;
            z-index: 1;
        }
        .product-card { transition: transform 0.3s, box-shadow 0.3s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .product-card a { text-decoration: none; color: inherit; }
        .filter-section { background: #f8f9fa; padding: 1rem; border-radius: 8px; }
        .filter-collapse { display: none; }
        @media (max-width: 768px) {
            .filter-section { margin-bottom: 1rem; }
            .filter-collapse { display: block; }
        }
        .btn-gold { background-color: #ffd700; color: #000; }
        .btn-gold:hover { background-color: #e6c200; }
        .sale-banner {
            background: url('https://images.unsplash.com/photo-1543163521-1bf539c55dd2') no-repeat center center;
            background-size: cover;
            position: relative;
        }
        .sale-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
        }
        .sale-banner .container {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body>
    <%- include('.././Partials/user/navbar', { user: user, cartCount: cartCount, search: search }) %>
    
    <section class="hero-section text-white py-5">
        <div class="container text-end">
            <h1 class="display-4">NEW YEAR, <br>BIG SALE</h1>
            <p class="lead">DISCOUNT UP TO 50%</p>
            <a href="/products" class="btn btn-gold btn-lg">SHOP NOW</a>
        </div>
    </section>

    <section class="container my-5">
        <h2 class="section-title text-center mb-4">New Arrivals</h2>
        <div class="row g-4">
            <% newArrivals.forEach(product => { %>
                <div class="col-6 col-md-3">
                    <a href="/products/<%= product._id %>">
                        <div class="card product-card border-0">
                            <img src="<%= product.images[0] || '/images/placeholder.jpg' %>" class="card-img-top" alt="<%= product.name %>">
                            <div class="card-body text-center">
                                <h5 class="product-title"><%= product.name %></h5>
                                <p class="text-muted"><%= product.brand.name %></p>
                                <div class="rating">
                                    <% for(let i = 0; i < Math.floor(product.rating); i++) { %>
                                        <i class="fas fa-star text-warning"></i>
                                    <% } %>
                                    <% for(let i = Math.floor(product.rating); i < 5; i++) { %>
                                        <i class="far fa-star text-muted"></i>
                                    <% } %>
                                </div>
                                <p class="product-price fw-bold">$<%= product.salePrice.toFixed(2) %></p>
                                <button class="btn btn-gold btn-sm add-to-cart" data-product-id="<%= product._id %>" onclick="event.stopPropagation();">Add to Cart</button>
                            </div>
                        </div>
                    </a>
                </div>
            <% }); %>
        </div>
    </section>

    <section class="sale-banner text-white py-4">
        <div class="container text-center">
            <h2>SALE</h2>
            <p>GRAB IT FAST - UP TO 50% OFF</p>
            <a href="/products?sale=true" class="btn btn-gold">Shop Sale</a>
        </div>
    </section>

    <section class="container my-5">
        <h2 class="section-title text-center mb-4">Trending</h2>
        <div class="row g-4">
            <% trendingProducts.forEach(product => { %>
                <div class="col-6 col-md-3">
                    <a href="/products/<%= product._id %>">
                        <div class="card product-card border-0">
                            <img src="<%= product.images[0] || '/images/placeholder.jpg' %>" class="card-img-top" alt="<%= product.name %>">
                            <div class="card-body text-center">
                                <h5 class="product-title"><%= product.name %></h5>
                                <p class="text-muted"><%= product.brand.name %></p>
                                <div class="rating">
                                    <% for(let i = 0; i < Math.floor(product.rating); i++) { %>
                                        <i class="fas fa-star text-warning"></i>
                                    <% } %>
                                    <% for(let i = Math.floor(product.rating); i < 5; i++) { %>
                                        <i class="far fa-star text-muted"></i>
                                    <% } %>
                                </div>
                                <p class="product-price fw-bold">$<%= product.salePrice.toFixed(2) %></p>
                                <button class="btn btn-gold btn-sm add-to-cart" data-product-id="<%= product._id %>" onclick="event.stopPropagation();">Add to Cart</button>
                            </div>
                        </div>
                    </a>
                </div>
            <% }); %>
        </div>
    </section>

    <section class="container my-5">
        <h2 class="section-title text-center mb-4">Explore More</h2>
        <div class="row g-4">
            <% exploreProducts.forEach(product => { %>
                <div class="col-6 col-md-3">
                    <a href="/products/<%= product._id %>">
                        <div class="card product-card border-0">
                            <img src="<%= product.images[0] || '/images/placeholder.jpg' %>" class="card-img-top" alt="<%= product.name %>">
                            <div class="card-body text-center">
                                <h5 class="product-title"><%= product.name %></h5>
                                <p class="text-muted"><%= product.brand.name %></p>
                                <div class="rating">
                                    <% for(let i = 0; i < Math.floor(product.rating); i++) { %>
                                        <i class="fas fa-star text-warning"></i>
                                    <% } %>
                                    <% for(let i = Math.floor(product.rating); i < 5; i++) { %>
                                        <i class="far fa-star text-muted"></i>
                                    <% } %>
                                </div>
                                <p class="product-price fw-bold">$<%= product.salePrice.toFixed(2) %></p>
                                <button class="btn btn-gold btn-sm add-to-cart" data-product-id="<%= product._id %>" onclick="event.stopPropagation();">Add to Cart</button>
                            </div>
                        </div>
                    </a>
                </div>
            <% }); %>
        </div>
    </section>

    <%- include('.././Partials/user/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', e => {
                    e.preventDefault();
                    document.querySelector(anchor.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                });
            });

            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltipTriggerList.forEach(el => new bootstrap.Tooltip(el));

            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', async () => {
                    const productId = button.getAttribute('data-product-id');
                    const isLoggedIn = <%= user ? 'true' : 'false' %>;
                    if (!isLoggedIn) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Please Log In',
                            text: 'You need to be logged in to add items to your cart.',
                            showConfirmButton: true,
                            confirmButtonText: 'Log In'
                        }).then(result => {
                            if (result.isConfirmed) window.location.href = '/login';
                        });
                        return;
                    }

                    try {
                        const response = await fetch('/user/cart/add', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ productId, quantity: 1 })
                        });
                        const data = await response.json();
                        if (data.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Added to Cart',
                                text: 'Product added to your cart!',
                                timer: 1500
                            });
                            const cartBadge = document.querySelector('.cart-count');
                            if (cartBadge) {
                                cartBadge.textContent = parseInt(cartBadge.textContent) + 1;
                            }
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: data.message || 'Failed to add to cart'
                            });
                        }
                    } catch (error) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'An error occurred while adding to cart'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>